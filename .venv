#!/bin/bash

# @license BSD-2-Clause
# @copyright Mat. 2024-present

# This file must be used with ". ./.venv" *from bash*.




# ensure sourcing
if [ "${BASH_SOURCE-}" = "$0" ]; then
    echo "You must source this script: \$ . $0" >&2
    exit 8
fi

# paths
PROJECT_ROOT=$(pwd)

# node
unset -f node >/dev/null 2>&1
alias node 2>/dev/null >/dev/null && unalias node || true
node () {
    podman run -it --rm --net host -v $(pwd):/usr/src/app -w /usr/src/app node:20 node "$@"
}

# npm
unset -f npm >/dev/null 2>&1
alias npm 2>/dev/null >/dev/null && unalias npm || true
npm () {
    RP=$(realpath --relative-to="$PROJECT_ROOT" $(pwd))
    podman run -it --rm --net host -v "$PROJECT_ROOT":/usr/src/app -w /usr/src/app/"$RP" node:20 npm "$@"
}

# npx
unset -f npx >/dev/null 2>&1
alias npx 2>/dev/null >/dev/null && unalias npx || true
npx () {
    RP=$(realpath --relative-to="$PROJECT_ROOT" $(pwd))
    podman run -it --rm --net host -v "$PROJECT_ROOT":/usr/src/app -w /usr/src/app/"$RP" node:20 npx "$@"
}

# yarn
unset -f yarn >/dev/null 2>&1
alias yarn 2>/dev/null >/dev/null && unalias yarn || true
yarn () {
    RP=$(realpath --relative-to="$PROJECT_ROOT" $(pwd))
    podman run -it --rm --net host -v "$PROJECT_ROOT":/usr/src/app -w /usr/src/app/"$RP" node:20 yarn "$@"
}

# psql
unset -f psql >/dev/null 2>&1
alias psql 2>/dev/null >/dev/null && unalias psql || true
psql () {
    podman exec -it otrails-postgis psql "$@"
}

# reset bash hash
if [ -n "${BASH-}" ] || [ -n "${ZSH_VERSION-}" ]; then
    hash -r 2>/dev/null
fi
