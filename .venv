#!/bin/bash

# @license BSD-2-Clause
# @copyright Mat. 2024-present

# This file must be used with ". ./.venv" *from bash*.




# ensure sourcing
if [ "${BASH_SOURCE-}" = "$0" ]; then
    echo "You must source this script: \$ . $0" >&2
    exit 8
fi

# node
unset -f node >/dev/null 2>&1
alias node 2>/dev/null >/dev/null && unalias node || true
node () {
    podman run -it --rm -v $(pwd):/usr/src/app -w /usr/src/app node:20 node "$@"
}

# npm
unset -f npm >/dev/null 2>&1
alias npm 2>/dev/null >/dev/null && unalias npm || true
npm () {
    podman run -it --rm -v $(pwd):/usr/src/app -w /usr/src/app node:20 npm "$@"
}

# yarn
unset -f yarn >/dev/null 2>&1
alias yarn 2>/dev/null >/dev/null && unalias yarn || true
yarn () {
    ls | grep package.json > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        podman run -it --rm -v $(pwd):/usr/src/app -w /usr/src/app node:20 yarn "$@"
    else
        echo "Missing package.json file."
        return 1
    fi
}

# psql
unset -f psql >/dev/null 2>&1
alias psql 2>/dev/null >/dev/null && unalias psql || true
psql () {
    podman exec -it otrails-postgis psql "$@"
}

# reset bash hash
if [ -n "${BASH-}" ] || [ -n "${ZSH_VERSION-}" ]; then
    hash -r 2>/dev/null
fi
